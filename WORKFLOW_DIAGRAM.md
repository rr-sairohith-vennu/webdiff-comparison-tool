# WebDiff - Complete Workflow Diagram

## ğŸ¯ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Server    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Playwright â”‚
â”‚  (Frontend) â”‚         â”‚  (Backend)  â”‚         â”‚  (Browsers) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                       â”‚                        â”‚
   index.html            server.js              Chromium x2
   Socket.io             Express.js             (Headless)
   JavaScript            Socket.io
                         Sharp (Images)
```

---

## ğŸ”„ Complete Flow (Step by Step)

### **STEP 1: User Input**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          USER BROWSER                â”‚
â”‚  http://localhost:4000               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  ğŸ“ URL 1: https://prod.com/page     â”‚
â”‚  ğŸ“ URL 2: https://preview.com/page  â”‚
â”‚  ğŸ“ Buttons: Pending, Confirmed      â”‚
â”‚                                      â”‚
â”‚       [ğŸš€ Compare Now]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP POST /api/compare
           â”‚ { url1, url2, clickAction }
           â–¼
```

---

### **STEP 2: Backend Receives Request**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        EXPRESS SERVER                â”‚
â”‚        (server.js)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  app.post('/api/compare')            â”‚
â”‚    â†“                                 â”‚
â”‚  new UIComparisonEngine()            â”‚
â”‚    â†“                                 â”‚
â”‚  engine.run()                        â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Initialize comparison
           â–¼
```

---

### **STEP 3: Launch Browsers (Playwright)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PLAYWRIGHT                          â”‚
â”‚         (Browser Automation)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  const browser = await chromium.launch({    â”‚
â”‚    headless: true                           â”‚
â”‚  })                                         â”‚
â”‚                                             â”‚
â”‚  Browser 1 â”€â”€â–º Opens URL 1 (Production)     â”‚
â”‚  Browser 2 â”€â”€â–º Opens URL 2 (Preview)        â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Socket.io emit: "Launching browsers..."
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER BROWSER (Real-time Update)   â”‚
â”‚   Progress: ğŸ”„ Launching browsers... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **STEP 4: Load Pages & Handle Popups**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BROWSER 1 (Prod)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  page1.goto(url1)                           â”‚
â”‚    â†“                                        â”‚
â”‚  âš ï¸  Popup detected!                        â”‚
â”‚    â†“                                        â”‚
â”‚  Click close button                         â”‚
â”‚    â†“                                        â”‚
â”‚  ğŸ” Check URL changed?                      â”‚
â”‚    â†“                                        â”‚
â”‚  âŒ Yes! Redirected to /verify              â”‚
â”‚    â†“                                        â”‚
â”‚  ğŸ”„ Navigate back to original URL           â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… Correct page loaded                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BROWSER 2 (Preview)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  page2.goto(url2)                           â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… No popup detected                        â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… Page loaded successfully                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

           â”‚
           â”‚ Socket.io emit: "Pages loaded..."
           â–¼
```

---

### **STEP 5: Extract DOM Elements**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ELEMENT EXTRACTION (Both Pages)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  page.evaluate(() => {                      â”‚
â”‚    const elements = [];                     â”‚
â”‚                                             â”‚
â”‚    // Extract buttons                      â”‚
â”‚    document.querySelectorAll('button')      â”‚
â”‚      .forEach(btn => {                      â”‚
â”‚        elements.push({                      â”‚
â”‚          text: btn.innerText,               â”‚
â”‚          x: btn.getBoundingClientRect().x,  â”‚
â”‚          y: btn.getBoundingClientRect().y,  â”‚
â”‚          width: btn.offsetWidth,            â”‚
â”‚          height: btn.offsetHeight,          â”‚
â”‚          tagName: 'button'                  â”‚
â”‚        })                                   â”‚
â”‚      });                                    â”‚
â”‚                                             â”‚
â”‚    // Extract links, images, text...       â”‚
â”‚    return elements;                         â”‚
â”‚  })                                         â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RESULTS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  URL 1: 340 elements                        â”‚
â”‚  [                                          â”‚
â”‚    { text: "Rakuten Card Rewards",          â”‚
â”‚      x: 150, y: 80, width: 200, height: 40, â”‚
â”‚      tagName: "button" },                   â”‚
â”‚    { text: "$69.42",                        â”‚
â”‚      x: 300, y: 150, ...},                  â”‚
â”‚    ...                                      â”‚
â”‚  ]                                          â”‚
â”‚                                             â”‚
â”‚  URL 2: 469 elements                        â”‚
â”‚  [                                          â”‚
â”‚    { text: "rakuten card rewards",          â”‚
â”‚      x: 180, y: 85, ...},                   â”‚
â”‚    { text: "$16.87",                        â”‚
â”‚      x: 300, y: 150, ...},                  â”‚
â”‚    ...                                      â”‚
â”‚  ]                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **STEP 6: Match Elements (Algorithm)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MATCHING ALGORITHM                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  For each element in URL1:                  â”‚
â”‚    â†“                                        â”‚
â”‚  1. Find nearby elements in URL2            â”‚
â”‚     (within 200px radius)                   â”‚
â”‚    â†“                                        â”‚
â”‚  2. Calculate similarity score              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ â€¢ Text match: 50% weight    â”‚        â”‚
â”‚     â”‚ â€¢ Position: 30% weight      â”‚        â”‚
â”‚     â”‚ â€¢ Size: 20% weight          â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚    â†“                                        â”‚
â”‚  3. If score > 60% â†’ MATCHED âœ…             â”‚
â”‚     If score < 60% â†’ REMOVED âŒ             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          EXAMPLE MATCHING                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  URL1: "Rakuten Card Rewards" at (150,80)   â”‚
â”‚           â†“                                 â”‚
â”‚  Search URL2 within (0-350, 0-280)          â”‚
â”‚           â†“                                 â”‚
â”‚  Found: "rakuten card rewards" at (180,85)  â”‚
â”‚           â†“                                 â”‚
â”‚  Similarity:                                â”‚
â”‚    Text: 90% (case different)               â”‚
â”‚    Position: 30% (32px away)                â”‚
â”‚    Size: 20% (similar)                      â”‚
â”‚    Total: 92% âœ… MATCHED                    â”‚
â”‚                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚                                             â”‚
â”‚  URL1: "$69.42" at (300,150)                â”‚
â”‚           â†“                                 â”‚
â”‚  Found: "$16.87" at (300,150)               â”‚
â”‚           â†“                                 â”‚
â”‚  Similarity:                                â”‚
â”‚    Text: 0% (different)                     â”‚
â”‚    Position: 100% (exact same)              â”‚
â”‚    Size: 100% (same)                        â”‚
â”‚    Total: 65% âœ… MATCHED                    â”‚
â”‚           â†“                                 â”‚
â”‚  But text different + currency detected     â”‚
â”‚  â†’ "Currency Amount Changed" ğŸ’°             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            MATCHING RESULTS                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Matched: 59 elements                     â”‚
â”‚  â€¢ Unmatched in URL1: 281 (REMOVED)         â”‚
â”‚  â€¢ Unmatched in URL2: 410 (ADDED)           â”‚
â”‚  â€¢ Total Differences: 390                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **STEP 7: Categorize Differences**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       CATEGORIZATION LOGIC                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  If (element in URL1 && not in URL2):       â”‚
â”‚    â†’ Type: "Content Removed"                â”‚
â”‚    â†’ Severity: "high"                       â”‚
â”‚    â†’ url1Value: "Rakuten Card Rewards"      â”‚
â”‚    â†’ url2Value: "Not present"               â”‚
â”‚                                             â”‚
â”‚  If (element in URL2 && not in URL1):       â”‚
â”‚    â†’ Type: "Content Added"                  â”‚
â”‚    â†’ Severity: "high"                       â”‚
â”‚    â†’ url1Value: "Not present"               â”‚
â”‚    â†’ url2Value: "manage rakuten card"       â”‚
â”‚                                             â”‚
â”‚  If (matched && text has $XX.XX):           â”‚
â”‚    â†’ Type: "Content"                        â”‚
â”‚    â†’ Category: "Currency Amount Changed"    â”‚
â”‚    â†’ Severity: "high"                       â”‚
â”‚    â†’ url1Value: "$69.42"                    â”‚
â”‚    â†’ url2Value: "$16.87"                    â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **STEP 8: Take Screenshots**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SCREENSHOT CAPTURE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  await page1.screenshot({                   â”‚
â”‚    path: 'screenshots/prod_123.png',        â”‚
â”‚    fullPage: true                           â”‚
â”‚  })                                         â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… URL1 screenshot saved (CLEAN)           â”‚
â”‚                                             â”‚
â”‚  await page2.screenshot({                   â”‚
â”‚    path: 'screenshots/preview_123.png',     â”‚
â”‚    fullPage: true                           â”‚
â”‚  })                                         â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… URL2 screenshot saved (CLEAN)           â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

           â”‚
           â”‚ Socket.io emit: "Taking screenshots..."
           â–¼
```

---

### **STEP 9: Draw Red Boxes (Sharp)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        IMAGE PROCESSING (Sharp)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  const image = sharp('preview_123.png');    â”‚
â”‚                                             â”‚
â”‚  For each difference:                       â”‚
â”‚    â†“                                        â”‚
â”‚    const svg = `                            â”‚
â”‚      <svg>                                  â”‚
â”‚        <rect x="${x}" y="${y}"              â”‚
â”‚              width="${w}" height="${h}"     â”‚
â”‚              stroke="red"                   â”‚
â”‚              stroke-width="3"               â”‚
â”‚              fill="none"/>                  â”‚
â”‚      </svg>                                 â”‚
â”‚    `;                                       â”‚
â”‚    â†“                                        â”‚
â”‚    image.composite([{                       â”‚
â”‚      input: Buffer.from(svg),               â”‚
â”‚      top: 0, left: 0                        â”‚
â”‚    }]);                                     â”‚
â”‚                                             â”‚
â”‚  image.toFile('preview_123_highlighted.png');â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… Highlighted screenshot saved            â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            VISUAL RESULT                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ“· prod_123.png (clean)                    â”‚
â”‚  ğŸ“· preview_123_highlighted.png             â”‚
â”‚      â†‘                                      â”‚
â”‚      Contains RED BOXES around:             â”‚
â”‚      â€¢ "rakuten card rewards" button        â”‚
â”‚      â€¢ "$16.87" (currency change)           â”‚
â”‚      â€¢ "mabubasha $42.48" (new content)     â”‚
â”‚      â€¢ All 390 differences                  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **STEP 10: Send Results to Frontend**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        BUILD RESPONSE (JSON)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  const result = {                           â”‚
â”‚    timestamp: 1729025678000,                â”‚
â”‚    url1: "https://prod.com/page",           â”‚
â”‚    url2: "https://preview.com/page",        â”‚
â”‚    totalDifferences: 390,                   â”‚
â”‚    summary: {                               â”‚
â”‚      bySeverity: {                          â”‚
â”‚        high: 390,                           â”‚
â”‚        medium: 0,                           â”‚
â”‚        low: 0                               â”‚
â”‚      }                                      â”‚
â”‚    },                                       â”‚
â”‚    differences: [                           â”‚
â”‚      {                                      â”‚
â”‚        type: "Content",                     â”‚
â”‚        category: "Currency Amount Changed", â”‚
â”‚        severity: "high",                    â”‚
â”‚        url1Value: "$69.42",                 â”‚
â”‚        url2Value: "$16.87"                  â”‚
â”‚      },                                     â”‚
â”‚      // ... 389 more                        â”‚
â”‚    ],                                       â”‚
â”‚    screenshots: {                           â”‚
â”‚      url1: "screenshots/prod_123.png",      â”‚
â”‚      url2: "screenshots/preview_123.png",   â”‚
â”‚      highlighted: {                         â”‚
â”‚        url2: "preview_123_highlighted.png"  â”‚
â”‚      }                                      â”‚
â”‚    }                                        â”‚
â”‚  };                                         â”‚
â”‚                                             â”‚
â”‚  res.json({ success: true, result });       â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

           â”‚
           â”‚ HTTP Response (JSON)
           â–¼
```

---

### **STEP 11: Display Results in Browser**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        USER BROWSER (index.html)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ“Š Comparison Results                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  390 Total Differences              â”‚   â”‚
â”‚  â”‚  390 High Priority                  â”‚   â”‚
â”‚  â”‚    0 Medium Priority                â”‚   â”‚
â”‚  â”‚    0 Low Priority                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  ğŸ–¼ï¸ Screenshots (Side by Side)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  URL 1      â”‚  URL 2      â”‚             â”‚
â”‚  â”‚  (Clean)    â”‚  (Boxes) ğŸ”´ â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                             â”‚
â”‚  ğŸ“‹ Detailed Differences (29 shown)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Content | Currency Changed | high   â”‚   â”‚
â”‚  â”‚ $69.42  â†’ $16.87                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Content | Content Added | high      â”‚   â”‚
â”‚  â”‚ Not present â†’ rakuten card rewards  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Tech Stack Deep Dive

### **Backend Technologies**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Node.js v22.20.0                        â”‚
â”‚  â””â”€ JavaScript Runtime                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Express.js v4.21.2                      â”‚
â”‚  â””â”€ Web Server Framework                 â”‚
â”‚     â€¢ Handles HTTP requests              â”‚
â”‚     â€¢ Serves static files (index.html)   â”‚
â”‚     â€¢ API endpoint: /api/compare         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Socket.io v4.8.1                        â”‚
â”‚  â””â”€ Real-time Communication              â”‚
â”‚     â€¢ Bidirectional event-based          â”‚
â”‚     â€¢ Progress updates to browser        â”‚
â”‚     â€¢ No polling needed                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Playwright v1.56.0                      â”‚
â”‚  â””â”€ Browser Automation                   â”‚
â”‚     â€¢ Launches Chromium headless         â”‚
â”‚     â€¢ Navigates to URLs                  â”‚
â”‚     â€¢ Extracts DOM elements              â”‚
â”‚     â€¢ Takes screenshots                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sharp v0.34.4                           â”‚
â”‚  â””â”€ High-performance Image Processing    â”‚
â”‚     â€¢ Draws SVG overlays (red boxes)     â”‚
â”‚     â€¢ Composites images                  â”‚
â”‚     â€¢ Fast PNG manipulation              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Pixelmatch v7.1.0                       â”‚
â”‚  â””â”€ Pixel-level Image Comparison         â”‚
â”‚     â€¢ (Not currently used in main flow)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PNG.js v7.0.0                           â”‚
â”‚  â””â”€ PNG Image Parser                     â”‚
â”‚     â€¢ Read/write PNG files               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cheerio v1.0.0                          â”‚
â”‚  â””â”€ HTML Parser (jQuery-like)            â”‚
â”‚     â€¢ Parse HTML structure               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Chalk v5.3.0                            â”‚
â”‚  â””â”€ Terminal Styling                     â”‚
â”‚     â€¢ Colored console output             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Frontend Technologies**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vanilla JavaScript (ES6+)               â”‚
â”‚  â””â”€ No frameworks!                       â”‚
â”‚     â€¢ Fetch API for HTTP requests        â”‚
â”‚     â€¢ DOM manipulation                   â”‚
â”‚     â€¢ Event listeners                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Socket.io Client                        â”‚
â”‚  â””â”€ Receives real-time updates           â”‚
â”‚     â€¢ socket.on('progress', ...)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CSS3                                    â”‚
â”‚  â””â”€ Modern dark theme                    â”‚
â”‚     â€¢ Flexbox/Grid layouts               â”‚
â”‚     â€¢ Animations                         â”‚
â”‚     â€¢ Google Fonts (Inter)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Summary

```
USER INPUT (URLs)
      â†“
EXPRESS SERVER (receives request)
      â†“
PLAYWRIGHT (launches 2 Chrome browsers)
      â†“
LOAD PAGES (handle popups, redirects)
      â†“
EXTRACT ELEMENTS (query DOM for all elements)
      â†“
MATCH ALGORITHM (compare 340 vs 469 elements)
      â†“
CATEGORIZE (removed/added/changed)
      â†“
TAKE SCREENSHOTS (full page PNG)
      â†“
DRAW RED BOXES (Sharp image processing)
      â†“
SEND RESULTS (JSON + screenshots)
      â†“
BROWSER DISPLAYS (side-by-side comparison)
```

---

## âš¡ Performance Breakdown

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Total Time: 15-25 seconds             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Launch browsers      â”‚ 3-5s        â”‚
â”‚  2. Load pages           â”‚ 5-10s       â”‚
â”‚  3. Handle popups        â”‚ 2-3s        â”‚
â”‚  4. Extract elements     â”‚ 2-3s        â”‚
â”‚  5. Match elements       â”‚ 1-2s        â”‚
â”‚  6. Take screenshots     â”‚ 2-3s        â”‚
â”‚  7. Draw red boxes       â”‚ 1-2s        â”‚
â”‚  8. Send results         â”‚ <1s         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key Components

### **UIComparisonEngine (server.js)**
```javascript
class UIComparisonEngine {

  async run() {
    await this.initBrowser();        // Launch Playwright
    await this.loadPages();           // Load URLs
    await this.handlePopups();        // Close popups
    await this.extractElements();     // Get DOM elements
    const diffs = await this.compare(); // Match & categorize
    await this.takeScreenshots();     // Capture images
    await this.highlightDifferences(); // Draw boxes
    return results;                   // Return JSON
  }

  async comparePageElements(el1[], el2[]) {
    // Match elements by similarity
    // Return differences array
  }

}
```

---

## ğŸ” Security & Constraints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ Runs locally (localhost:4000)      â”‚
â”‚  â€¢ No external API calls               â”‚
â”‚  â€¢ No data stored externally           â”‚
â”‚  â€¢ No authentication required          â”‚
â”‚  â€¢ Screenshots saved locally           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‰ Summary

**This is how WebDiff works:**
1. User enters 2 URLs â†’ Backend receives
2. Playwright launches 2 Chrome browsers â†’ Loads pages
3. DOM elements extracted â†’ Compared using math
4. Differences categorized â†’ Screenshots taken
5. Sharp draws red boxes â†’ Results sent to browser
6. User sees side-by-side comparison in 20 seconds!

**No AI. Just logic, math, and automation!** ğŸš€
